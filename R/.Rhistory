pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
row_spec(c(1,3,8,9,15), bold = T, color = "white", background = "#4287f5")
# Clean and transform the data
pnl_statement <- pnl_data %>%
# Remove any NA rows
filter(!is.na(`Category`)) %>%
# Rename columns for clarity
rename(
Category = `Category`,
description = `Description`,
Batch_1 = `Amount (UGX)...3`,
Batch_2 = `Amount (UGX)...4`,
Batch_3 = `Amount (UGX)...5`
) %>%
# Select only the relevant columns
select(Category, Batch_1, Batch_2, Batch_3)
pnl_statement$Batch_1 <- currency(pnl_statement$Batch_1, symbol = "", digits = 0L)
pnl_statement$Batch_2 <- currency(pnl_statement$Batch_2, symbol = "", digits = 0L)
pnl_statement$Batch_3 <- currency(pnl_statement$Batch_3, symbol = "", digits = 0L)
pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
row_spec(c(1,3,8,9,15), bold = T, color = "white", background = "#4287f5")
kbl(dt) %>%
kable_classic() %>%
add_header_above(c(" " = 1, "Group 1" = 2, "Group 2" = 2, "Group 3" = 2))
kbl(mtcars[1:10, 1:6], caption = "Group Rows") %>%
kable_paper("striped", full_width = F) %>%
pack_rows("Group 1", 4, 7) %>%
pack_rows("Group 2", 8, 10)
# Add indention
kbl(dt) %>%
kable_paper("striped", full_width = F) %>%
add_indent(c(1, 3, 5))
pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
add_indent(c(2, 4, 5,6,7,10,11,12,13,14))
pnl_data <- read_excel("data/JC Poultry Farm - Business Operating Model_v1_250323.xlsx",
sheet = "PnL",
skip = 3)  # Skip the first 3 rows to get to the data
# Clean and transform the data
pnl_statement <- pnl_data %>%
# Remove any NA rows
filter(!is.na(`Category`)) %>%
# Rename columns for clarity
rename(
Category = `Category`,
description = `Description`,
Batch_1 = `Amount (UGX)...3`,
Batch_2 = `Amount (UGX)...4`,
Batch_3 = `Amount (UGX)...5`
) %>%
# Select only the relevant columns
select(Category, Batch_1, Batch_2, Batch_3)
pnl_statement$Batch_1 <- currency(pnl_statement$Batch_1, symbol = "", digits = 0L)
pnl_statement$Batch_2 <- currency(pnl_statement$Batch_2, symbol = "", digits = 0L)
pnl_statement$Batch_3 <- currency(pnl_statement$Batch_3, symbol = "", digits = 0L)
pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
add_indent(c(2, 4, 5,6,7,10,11,12,13,14))
pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
add_indent(c(2, 4, 5,6,7,9,10,11,12,13))
pnl_statement |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
add_indent(c(2, 4, 5,6,7,9,10,11,12,13)) |>
row_spec(c(1,3,8,14), bold = T, color = "white", background = "#4287f5")
library(tidyverse)
library(lubridate)
library(highcharter)
library(DT)
library(bslib)
library(bsicons)
library(shiny)
library(gt)
library(glue)
library(gtExtras)
library(kableExtra)
library(readxl)
library(scales)
library(formattable)
pnl_data <- read_excel("data/JC Poultry Farm - Business Operating Model_v1_250323.xlsx",
sheet = "PnL",
skip = 3)  # Skip the first 3 rows to get to the data
# Clean and transform the data
pnl_statement <- pnl_data %>%
# Remove any NA rows
filter(!is.na(`Category`)) %>%
# Rename columns for clarity
rename(
Category = `Category`,
description = `Description`,
Batch_1 = `Amount (UGX)...3`,
Batch_2 = `Amount (UGX)...4`,
Batch_3 = `Amount (UGX)...5`
) %>%
# Select only the relevant columns
select(Category, Batch_1, Batch_2, Batch_3)
View(pnl_statement)
# Read CSV data
transactions <- read.csv("data/jc_farms_transaction_data_20250327_v2.csv")
# Filter and aggregate Batch_4 data
batch4 <- transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ "Sales Revenue",
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
) %>%
filter(!is.na(Category)) %>%
group_by(Category) %>%
summarise(Batch_4 = sum(Amount, na.rm = TRUE))
View(batch4)
transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ "Sales Revenue",
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
)
View(transactions)
# Filter and aggregate Batch_4 data
batch4 <- transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ Select.Category.3,
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category.2,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category.1,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
) %>%
filter(!is.na(Category)) %>%
group_by(Category) %>%
summarise(Batch_4 = sum(Amount, na.rm = TRUE))
View(batch4)
transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ Select.Category.3,
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category.2,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category.1,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
)
# Create full category structure
categories <- data.frame(
Category = c(
"Revenues", "Sales Revenue", "Cost of Goods Sold (COGS)", "Feed Costs",
"Veterinary Supplies", "Chicks Purchased", "Other Direct Costs",
"Operating Expenses (OPEX)", "Salaries and Wages", "Utilities (Electricity, Water, etc.)",
"Transportation Costs", "Marketing Expenses", "Other Operating Expenses",
"Net Profit/Loss"
)
)
View(categories)
?coalesce
# Merge with categories and fill missing values
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
View(batch4_full)
# Merge with categories and fill missing values
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue (Broilers, Eggs, etc.)"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category")
rownames(batch4$Category) <- c("Chicks Purchased",
"Feed Costs",
"Other Operating Expenses",
"Salaries and Wages",
"Sales Revenue",
"Transportation Costs",
"Utilities (Electricity, Water, etc.)",
"Veterinary Supplies")
colnames(batch4$Category) <- c("Chicks Purchased",
"Feed Costs",
"Other Operating Expenses",
"Salaries and Wages",
"Sales Revenue",
"Transportation Costs",
"Utilities (Electricity, Water, etc.)",
"Veterinary Supplies")
View(batch4)
# Filter and aggregate Batch_4 data
batch4 <- transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ Select.Category.3,
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category.2,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category.1,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
) %>%
filter(!is.na(Category)) %>%
group_by(Category) %>%
summarise(Batch_4 = sum(Amount, na.rm = TRUE))
batch4$Category[5] <- "Sales Revenue"
# Create full category structure
categories <- data.frame(
Category = c(
"Revenues", "Sales Revenue", "Cost of Goods Sold (COGS)", "Feed Costs",
"Veterinary Supplies", "Chicks Purchased", "Other Direct Costs",
"Operating Expenses (OPEX)", "Salaries and Wages", "Utilities (Electricity, Water, etc.)",
"Transportation Costs", "Marketing Expenses", "Other Operating Expenses",
"Net Profit/Loss"
)
)
# Merge with categories and fill missing values
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue (Broilers, Eggs, etc.)"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ Batch_4[Category == "Revenues"] - Batch_4[Category == "Cost of Goods Sold (COGS)"] - Batch_4[Category == "Operating Expenses (OPEX)"],
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ (Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"])),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Revenues"] - (Batch_4[Category == "Cost of Goods Sold (COGS)"] + Batch_4[Category == "Operating Expenses (OPEX)"])),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Revenues"]) -
sum(Batch_4[Category == "Cost of Goods Sold (COGS)"]) -
sum(Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Revenues"]), #-
#sum(Batch_4[Category == "Cost of Goods Sold (COGS)"]) -
#  sum(Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Sales Revenues"]), #-
#sum(Batch_4[Category == "Cost of Goods Sold (COGS)"]) -
#  sum(Batch_4[Category == "Operating Expenses (OPEX)"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Sales Revenues"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Sales Revenues"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ (Batch_4[Category == "Sales Revenues"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
Category == "Net Profit/Loss" ~ sum(Batch_4[Category == "Sales Revenues"]),
TRUE ~ Batch_4
))
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
TRUE ~ Batch_4
))
batch4_full_test <- batch4_full |>
mutate(
Batch_4 = ifelse(
Category == "Net Profit/Loss",
Batch_4[Category == "Revenues"] -
(Batch_4[Category == "Cost of Goods Sold (COGS)"] +
Batch_4[Category == "Operating Expenses (OPEX)"]),
Batch_4
)
)
View(batch4_full_test)
batch4_full <- batch4_full |>
mutate(
Batch_4 = ifelse(
Category == "Net Profit/Loss",
Batch_4[Category == "Revenues"] -
(Batch_4[Category == "Cost of Goods Sold (COGS)"] +
Batch_4[Category == "Operating Expenses (OPEX)"]),
Batch_4
)
)
# Merge with original PnL
final_pnl <- pnl_statement %>%
left_join(batch4_full, by = "Category")
View(final_pnl)
# Format numbers with commas
final_pnl <- final_pnl %>%
mutate(across(starts_with("Batch"), ~format(., big.mark = ",", scientific = FALSE)))
pnl_data <- read_excel("data/JC Poultry Farm - Business Operating Model_v1_250323.xlsx",
sheet = "PnL",
skip = 3)  # Skip the first 3 rows to get to the data
# Clean and transform the data
pnl_statement <- pnl_data %>%
# Remove any NA rows
filter(!is.na(`Category`)) %>%
# Rename columns for clarity
rename(
Category = `Category`,
description = `Description`,
Batch_1 = `Amount (UGX)...3`,
Batch_2 = `Amount (UGX)...4`,
Batch_3 = `Amount (UGX)...5`
) %>%
# Select only the relevant columns
select(Category, Batch_1, Batch_2, Batch_3)
# Read CSV data
transactions <- read.csv("data/jc_farms_transaction_data_20250327_v2.csv")
# Filter and aggregate Batch_4 data
batch4 <- transactions %>%
filter(Select.Batch.Number == "Batch 4") %>%
mutate(
Category = case_when(
Select.Account.Type == "Revenues" ~ Select.Category.3,
Select.Account.Type == "Cost of Goods Sold (COGS)" ~ Select.Category.2,
Select.Account.Type == "Operating Expenditure (OPEX)" ~ Select.Category.1,
TRUE ~ NA_character_
),
Amount = as.numeric(gsub(",", "", Amount..UGX.))
) %>%
filter(!is.na(Category)) %>%
group_by(Category) %>%
summarise(Batch_4 = sum(Amount, na.rm = TRUE))
#Sub-setting the 1 cell I want to change
batch4$Category[5] <- "Sales Revenue"
# Create full category structure
categories <- data.frame(
Category = c(
"Revenues", "Sales Revenue", "Cost of Goods Sold (COGS)", "Feed Costs",
"Veterinary Supplies", "Chicks Purchased", "Other Direct Costs",
"Operating Expenses (OPEX)", "Salaries and Wages", "Utilities (Electricity, Water, etc.)",
"Transportation Costs", "Marketing Expenses", "Other Operating Expenses",
"Net Profit/Loss"
)
)
batch4_full <- categories %>%
left_join(batch4, by = "Category") %>%
mutate(Batch_4 = coalesce(Batch_4, 0)) %>%
# Calculate totals
mutate(Batch_4 = case_when(
Category == "Revenues" ~ sum(Batch_4[Category == "Sales Revenue"]),
Category == "Cost of Goods Sold (COGS)" ~ sum(Batch_4[Category %in% c("Feed Costs", "Veterinary Supplies", "Chicks Purchased", "Other Direct Costs")]),
Category == "Operating Expenses (OPEX)" ~ sum(Batch_4[Category %in% c("Salaries and Wages", "Utilities (Electricity, Water, etc.)", "Transportation Costs", "Marketing Expenses", "Other Operating Expenses")]),
TRUE ~ Batch_4
))
batch4_full <- batch4_full |>
mutate(
Batch_4 = ifelse(
Category == "Net Profit/Loss",
Batch_4[Category == "Revenues"] -
(Batch_4[Category == "Cost of Goods Sold (COGS)"] +
Batch_4[Category == "Operating Expenses (OPEX)"]),
Batch_4
)
)
# Merge with original PnL
final_pnl <- pnl_statement %>%
left_join(batch4_full, by = "Category")
# Format numbers with commas
final_pnl <- final_pnl %>%
mutate(across(starts_with("Batch"), ~format(., big.mark = ",", scientific = FALSE)))
final_pnl |>
kbl(caption = "JC Farms Profit/Loss Statement") |>
kable_paper("striped", full_width = F) %>%
add_indent(c(2, 4, 5,6,7,9,10,11,12,13)) |>
row_spec(c(1,3,8,14), bold = T, color = "white", background = "#4287f5")
